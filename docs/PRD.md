# Data Agent 产品需求文档 (PRD)

> **版本**: v1.0  
> **创建日期**: 2025-10-01  
> **作者**: Dawn  
> **最后更新**: 2025-10-01

---

## 📋 目录

1. [项目概述](#1-项目概述)
2. [产品定位](#2-产品定位)
3. [核心功能](#3-核心功能)
4. [技术架构](#4-技术架构)
5. [用户角色与权限](#5-用户角色与权限)
6. [开发计划](#6-开发计划)
7. [参考案例](#7-参考案例)

---

## 1. 项目概述

### 1.1 项目名称
**Data Agent** - 智能数据处理与分析平台

### 1.2 项目背景
在数据驱动的时代，企业和个人面临着处理多种数据源的挑战：
- 数据分散在不同的系统（数据库、Excel、CSV、图片等）
- 数据处理需要编程技能，门槛高
- 数据分析缺乏智能化，效率低

### 1.3 项目目标
开发一个**智能化、易用的数据处理平台**，支持：
- 🔌 **多数据源接入**：数据库、CSV、Excel、图片（OCR）
- 🤖 **AI智能分析**：自然语言查询、智能推荐
- 📊 **可视化报表**：自动生成图表和报告
- 🚀 **低代码操作**：类似Teable的表格化操作体验

### 1.4 核心价值
- **降低门槛**：无需编程即可处理复杂数据
- **提升效率**：自动化数据清洗、转换和分析
- **智能洞察**：AI驱动的数据发现和建议

---

## 2. 产品定位

### 2.1 目标用户
- **数据分析师**：需要快速处理多源数据
- **业务人员**：需要从数据中获取洞察，但缺乏编程能力
- **中小企业**：需要低成本的数据分析解决方案
- **个人用户**：需要整理和分析个人数据

### 2.2 产品特点
| 特点 | 说明 |
|-----|------|
| 🎯 **多源支持** | 数据库、CSV、Excel、图片一站式处理 |
| 🧠 **AI增强** | 自然语言查询、智能数据清洗 |
| 📊 **表格化** | 参考Teable，提供类似Excel的操作体验 |
| 🔄 **实时协作** | 多人同时编辑和分析数据 |
| 🔌 **可扩展** | 插件化架构，支持自定义功能 |

### 2.3 竞品对比
| 功能 | Data Agent | Teable | Excel | Tableau |
|-----|-----------|--------|-------|---------|
| 多数据源 | ✅ | ⚠️ | ❌ | ✅ |
| AI智能 | ✅ | ❌ | ❌ | ⚠️ |
| 图片OCR | ✅ | ❌ | ❌ | ❌ |
| 表格化操作 | ✅ | ✅ | ✅ | ❌ |
| 自然语言查询 | ✅ | ❌ | ❌ | ⚠️ |
| 开源免费 | ✅ | ✅ | ❌ | ❌ |

---

## 3. 核心功能

### 3.1 数据源接入 (Phase 1)

#### 3.1.1 数据库连接
- **支持的数据库**：
  - ✅ MySQL
  - ✅ PostgreSQL
  - ⏳ MongoDB (后期)
  - ⏳ Redis (后期)
  
- **功能**：
  - 配置数据库连接信息（主机、端口、用户名、密码）
  - 选择数据库和表
  - 实时数据预览
  - 数据导入到工作区

#### 3.1.2 文件导入
- **CSV文件**：
  - 自动识别分隔符（逗号、制表符等）
  - 编码检测（UTF-8、GBK等）
  - 首行自动识别为列名
  - 数据类型自动推断

- **Excel文件**：
  - 支持 `.xls` 和 `.xlsx` 格式
  - 多工作表支持
  - 合并单元格处理
  - 公式计算结果导入

#### 3.1.3 图片数据提取 (OCR)
- **支持格式**：JPG、PNG、PDF
- **识别内容**：
  - 表格识别（智能提取行列结构）
  - 文本识别（提取纯文本数据）
  - 手写识别（后期）
- **技术方案**：
  - 集成 Tesseract OCR
  - 或调用第三方OCR API（百度、阿里云）

### 3.2 数据处理与分析 (Phase 2)

#### 3.2.1 数据清洗
- **缺失值处理**：
  - 删除缺失行/列
  - 填充固定值
  - 填充均值/中位数
  - 前向/后向填充

- **重复值处理**：
  - 识别重复行
  - 保留首次/最后出现
  - 自定义去重规则

- **异常值处理**：
  - 基于统计的异常检测（3σ原则）
  - 自定义阈值过滤
  - 异常值标记或删除

#### 3.2.2 数据转换
- **类型转换**：字符串↔数字↔日期↔布尔
- **格式化**：日期格式、数值精度、大小写转换
- **计算列**：基于公式创建新列（类似Excel公式）
- **数据拆分/合并**：列拆分、多列合并

#### 3.2.3 数据分析
- **统计分析**：
  - 基础统计：均值、中位数、众数、标准差
  - 分组统计：按某列分组计算
  - 透视表：多维度数据汇总

- **趋势分析**：
  - 时间序列分析
  - 同比/环比计算
  - 移动平均

- **相关性分析**：
  - 变量相关系数
  - 散点图矩阵

### 3.3 AI智能功能 (Phase 3)

#### 3.3.1 自然语言查询
用户可以用自然语言提问，系统自动解析并返回结果：

**示例**：
- "显示销售额前10的产品"
- "计算本月平均订单金额"
- "找出价格异常的商品"

**技术实现**：
- LLM（大语言模型）理解用户意图
- 生成SQL或数据处理代码
- 执行并返回结果

#### 3.3.2 智能推荐
- **数据类型推荐**：自动识别列的语义类型（邮箱、电话、地址等）
- **清洗建议**：检测数据质量问题，推荐清洗方案
- **分析建议**：根据数据特征，推荐合适的分析方法
- **可视化建议**：推荐最合适的图表类型

#### 3.3.3 智能问答
- 对数据进行对话式分析
- 上下文理解（记住之前的问题）
- 追问和深度分析

### 3.4 表格化工作区 (参考Teable) (Phase 1-2)

#### 3.4.1 表格视图
- **多视图支持**：
  - 网格视图（Grid View）- 类似Excel
  - 表单视图（Form View）- 数据录入
  - 看板视图（Kanban View）- 任务管理
  - 日历视图（Calendar View）- 时间维度

- **表格操作**：
  - 行列拖拽排序
  - 单元格编辑
  - 批量操作（选择多行进行操作）
  - 筛选和排序

#### 3.4.2 字段类型
参考Teable的丰富字段类型：
- 文本（单行/多行）
- 数字（整数/小数/百分比/货币）
- 日期/时间
- 选择（单选/多选）
- 复选框
- 链接/URL
- 附件
- 公式
- 关联字段（跨表引用）

#### 3.4.3 协作功能
- 实时多人编辑
- 评论和批注
- 变更历史记录
- 权限控制（查看/编辑/管理）

### 3.5 数据可视化 (Phase 2)

#### 3.5.1 图表类型
- **基础图表**：
  - 柱状图（条形图）
  - 折线图
  - 饼图（环形图）
  - 散点图
  - 面积图

- **高级图表**：
  - 热力图
  - 雷达图
  - 漏斗图
  - 地图（地理数据可视化）

#### 3.5.2 仪表盘
- 自定义布局
- 多图表组合
- 交互式筛选
- 实时数据刷新

#### 3.5.3 报告导出
- PDF报告
- Excel文件
- 图片（PNG/SVG）
- 分享链接（只读）

### 3.6 数据输出 (Phase 2)

- **导出格式**：CSV、Excel、JSON
- **数据库写回**：将处理结果写回数据库
- **API接口**：通过API获取处理结果
- **定时任务**：定期执行数据处理并输出

---

## 4. 技术架构

### 4.1 技术栈

#### 4.1.1 后端 (已初始化 ✅)
```
Spring Boot 3.5.6 + Java 17
├── Spring Web        # REST API
├── Validation        # 参数校验
├── FastJSON2         # JSON处理
├── Hutool-AI         # AI工具库
└── Lombok            # 代码简化
```

**待添加依赖**：
- `MyBatis-Plus` / `JPA` - 数据库ORM
- `Apache POI` - Excel处理
- `OpenCSV` - CSV处理
- `Tesseract OCR` - 图片识别
- `Spring AI` / `LangChain4j` - AI集成

#### 4.1.2 前端 (已初始化 ✅)
```
Vue 3.5 + TypeScript + Vite
├── Vue Router        # 路由
├── Pinia             # 状态管理
├── Vitest            # 单元测试
└── ESLint + Prettier # 代码规范
```

**待添加依赖**：
- `Ant Design Vue` / `Element Plus` - UI组件库
- `ECharts` - 数据可视化
- `Handsontable` / `AG Grid` - 表格组件（类似Excel）
- `Axios` - HTTP请求
- `VueUse` - 工具函数库

#### 4.1.3 数据库
- **主数据库**：PostgreSQL（存储用户数据、工作区配置）
- **缓存**：Redis（会话、任务队列）
- **文件存储**：MinIO / 阿里云OSS（存储上传的文件）

#### 4.1.4 AI服务
- **LLM接入**：OpenAI GPT-4 / 本地部署的开源模型
- **向量数据库**：Milvus / Qdrant（用于语义搜索）

### 4.2 系统架构图

```
┌─────────────────────────────────────────────────────┐
│                   前端 (Vue 3)                       │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │ 数据导入 │  │ 表格编辑 │  │ 数据分析 │          │
│  └──────────┘  └──────────┘  └──────────┘          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │ AI问答   │  │ 可视化   │  │ 协作     │          │
│  └──────────┘  └──────────┘  └──────────┘          │
└───────────────────┬─────────────────────────────────┘
                    │ REST API
┌───────────────────┴─────────────────────────────────┐
│              后端 (Spring Boot)                      │
│  ┌──────────────────────────────────────────────┐  │
│  │           Controller 层                       │  │
│  │  DataSourceController | AnalysisController   │  │
│  │  AIController | VisualizationController      │  │
│  └──────────────────┬───────────────────────────┘  │
│  ┌──────────────────┴───────────────────────────┐  │
│  │           Service 层                          │  │
│  │  DataImportService | DataCleanService        │  │
│  │  AIService | ChartService | OCRService       │  │
│  └──────────────────┬───────────────────────────┘  │
│  ┌──────────────────┴───────────────────────────┐  │
│  │           数据处理层                          │  │
│  │  DatabaseConnector | ExcelParser             │  │
│  │  CSVParser | OCREngine | AIEngine            │  │
│  └──────────────────┬───────────────────────────┘  │
└───────────────────┬─┴───────────────┬───────────────┘
                    │                 │
    ┌───────────────┴─────┐  ┌────────┴──────────┐
    │   PostgreSQL        │  │   Redis           │
    │   (主数据库)        │  │   (缓存/队列)     │
    └─────────────────────┘  └───────────────────┘
                    │
    ┌───────────────┴─────────────────────┐
    │  外部服务                            │
    │  - MySQL/PostgreSQL (用户数据库)    │
    │  - AI LLM API (智能分析)            │
    │  - OCR API (图片识别)               │
    │  - MinIO (文件存储)                 │
    └─────────────────────────────────────┘
```

### 4.3 数据流

```
用户操作 → 前端 → REST API → 后端处理 → 数据库/外部服务
         ↑                              ↓
         └──────────── 返回结果 ─────────┘
```

### 4.4 关键技术点

#### 4.4.1 实时协作（类似Teable）
- **WebSocket**：实时推送数据变更
- **OT (Operational Transformation)**：冲突解决
- **乐观锁**：并发控制

#### 4.4.2 大数据处理
- **流式处理**：分块读取大文件
- **异步任务**：后台处理耗时操作
- **进度反馈**：实时显示处理进度

#### 4.4.3 AI集成
- **Prompt工程**：设计高质量的提示词
- **流式响应**：实时显示AI生成内容
- **上下文管理**：保持对话上下文

---

## 5. 用户角色与权限

### 5.1 角色定义

| 角色 | 权限 | 说明 |
|-----|------|------|
| 👑 **管理员** | 全部权限 | 系统配置、用户管理 |
| 👤 **普通用户** | 创建工作区、导入数据、分析 | 主要用户群体 |
| 👁️ **访客** | 只读权限 | 通过分享链接访问 |

### 5.2 权限矩阵

| 功能 | 管理员 | 普通用户 | 访客 |
|-----|-------|---------|------|
| 用户管理 | ✅ | ❌ | ❌ |
| 创建工作区 | ✅ | ✅ | ❌ |
| 导入数据 | ✅ | ✅ | ❌ |
| 编辑数据 | ✅ | ✅ | ❌ |
| 查看数据 | ✅ | ✅ | ✅ |
| AI分析 | ✅ | ✅ | ❌ |
| 导出数据 | ✅ | ✅ | ⚠️ |
| 分享 | ✅ | ✅ | ❌ |

---

## 6. 开发计划

### 6.1 项目阶段

#### Phase 1: MVP (最小可行产品) - 4周
**目标**：实现基础的数据导入和表格化展示

- ✅ Week 1: 项目初始化（已完成）
  - [x] 后端框架搭建
  - [x] 前端框架搭建
  - [x] 基础配置

- 📝 Week 2: 数据导入
  - [ ] CSV文件上传和解析
  - [ ] Excel文件上传和解析
  - [ ] 数据预览界面

- 📝 Week 3: 表格化工作区
  - [ ] 集成表格组件（Handsontable）
  - [ ] 基础编辑功能
  - [ ] 筛选和排序

- 📝 Week 4: 数据导出
  - [ ] 导出为CSV
  - [ ] 导出为Excel
  - [ ] 基础测试和优化

#### Phase 2: 核心功能 - 6周
**目标**：数据处理、分析和可视化

- Week 5-6: 数据库连接
  - [ ] MySQL连接配置
  - [ ] PostgreSQL连接配置
  - [ ] 数据库表选择和导入

- Week 7-8: 数据处理
  - [ ] 数据清洗功能
  - [ ] 数据转换功能
  - [ ] 计算列和公式

- Week 9-10: 数据可视化
  - [ ] 集成ECharts
  - [ ] 基础图表（柱状图、折线图、饼图）
  - [ ] 简单仪表盘

#### Phase 3: AI增强 - 4周
**目标**：集成AI智能分析

- Week 11-12: AI基础
  - [ ] LLM API集成
  - [ ] 自然语言查询解析
  - [ ] 智能推荐引擎

- Week 13-14: OCR和高级功能
  - [ ] OCR图片识别
  - [ ] AI问答对话
  - [ ] 智能数据清洗建议

#### Phase 4: 协作和优化 - 4周
**目标**：多人协作和性能优化

- Week 15-16: 协作功能
  - [ ] WebSocket实时同步
  - [ ] 评论和批注
  - [ ] 权限管理

- Week 17-18: 性能优化和上线
  - [ ] 大文件处理优化
  - [ ] 缓存策略
  - [ ] 部署和监控

### 6.2 里程碑

| 里程碑 | 时间 | 目标 |
|-------|------|------|
| 🎯 M1: MVP发布 | Week 4 | 可以导入CSV/Excel并以表格形式展示和编辑 |
| 🎯 M2: 核心功能完成 | Week 10 | 支持数据库、数据处理、可视化 |
| 🎯 M3: AI功能上线 | Week 14 | 自然语言查询和OCR |
| 🎯 M4: 正式版发布 | Week 18 | 完整功能、性能优化、生产就绪 |

---

## 7. 参考案例

### 7.1 产品参考

#### Teable
- **优点**：
  - 类似Airtable的表格化操作体验
  - 开源、可自部署
  - 多视图支持
  - 实时协作

- **借鉴**：
  - UI/UX设计
  - 表格组件选型
  - 字段类型设计

#### Airtable
- **优点**：
  - 强大的关联功能
  - 丰富的视图类型
  - 良好的协作体验

#### Notion Database
- **优点**：
  - 灵活的数据结构
  - 强大的筛选和排序
  - 美观的UI

### 7.2 技术参考

#### 智能客服Agent
- **设计重点**：
  - 高并发场景下准确理解用户意图
  - 处理多样化请求
  - 情绪识别和响应

- **借鉴**：自然语言理解、意图识别

#### 自动化数据分析Agent
- **设计重点**：
  - 理解复杂的数据分析指令
  - 调用数据查询和可视化工具
  - 对结果进行初步解读

- **借鉴**：
  - LLM生成SQL
  - 数据分析流程自动化
  - 结果解释和建议

---

## 8. 非功能需求

### 8.1 性能要求
- **响应时间**：
  - 普通操作 < 1秒
  - 数据导入 < 5秒（100MB文件）
  - AI查询 < 3秒

- **并发支持**：
  - 支持100+并发用户
  - 单工作区支持10人同时编辑

### 8.2 安全性
- **数据安全**：
  - HTTPS加密传输
  - 数据库密码加密存储
  - 敏感数据脱敏

- **访问控制**：
  - JWT身份认证
  - RBAC权限模型
  - API限流

### 8.3 可用性
- **稳定性**：系统可用性 > 99.9%
- **数据可靠性**：自动备份、容灾恢复
- **可扩展性**：支持水平扩展

---

## 9. 风险评估

| 风险 | 级别 | 应对措施 |
|-----|------|---------|
| AI API成本过高 | 中 | 支持本地模型、缓存策略 |
| OCR识别准确率低 | 中 | 人工校正、多引擎对比 |
| 大数据性能问题 | 高 | 流式处理、分页加载 |
| 协作冲突处理复杂 | 中 | 采用成熟的OT算法 |
| 数据安全风险 | 高 | 加密、权限、审计日志 |

---

## 10. 附录

### 10.1 术语表
- **工作区 (Workspace)**：用户创建的数据处理空间
- **数据源 (Data Source)**：数据的来源（数据库、文件等）
- **字段 (Field)**：表格中的列
- **记录 (Record)**：表格中的行
- **视图 (View)**：数据的不同展示方式

### 10.2 更新日志
- 2025-10-01: v1.0 初始版本创建

---

**文档结束**

